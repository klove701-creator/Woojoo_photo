<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>🌟 우주성장일지</title>

  <!-- PWA / Splash tuning -->
  <meta name="theme-color" content="#667eea" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="icon" type="image/png" href="icon-192.png">
  <link rel="apple-touch-icon" href="icon-192.png">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Gmarket Sans 폰트 -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Gmarket+Sans:wght@300;500;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <!-- Splash Screen -->
  <div id="splashScreen" class="splash-screen">
    <div class="splash-images" id="splashImages"></div>
    <div class="splash-content">
      <div class="splash-logo">🌟 우주성장일지</div>
      <div class="splash-loading">추억을 불러오는 중...</div>
      <div class="splash-progress">
        <div class="splash-progress-bar"></div>
      </div>
    </div>
  </div>

  <!-- Navigation -->
  <div class="top">
    <div class="nav-container">
      <div class="nav-row-1">
        <div class="brand">🌟 우주성장일지</div>
        <button id="openSetup" class="settings-btn" title="설정">⚙️</button>
      </div>
      <div class="tabs" id="tabsContainer">
        <div class="tab active" data-tab="timeline">타임라인</div>
        <div class="tab" data-tab="calendar">캘린더</div>
        <div class="tab" data-tab="albums">앨범</div>
        <div class="tab" data-tab="schedule">일정표</div>
      </div>
    </div>
  </div>

  <div class="wrap">
    <!-- Setup Panel -->
    <div id="setup" class="card">
      <div style="display:none">
        <strong>🔧 앱 설정</strong><span class="muted">자동입력됨</span>
      </div>
      <div style="display:none">
        <label>Firebase Project ID</label>
        <input id="fb-project" type="text" placeholder="Project ID" style="width:100%;margin-bottom:8px" />
        <label>Firebase API Key</label>
        <input id="fb-api" type="text" placeholder="API Key" style="width:100%;margin-bottom:8px" />
        <label>Cloudinary Cloud Name</label>
        <input id="cld-name" type="text" placeholder="cloud name" style="width:100%;margin-bottom:8px" />
        <label>Cloudinary Upload Preset</label>
        <input id="cld-preset" type="text" placeholder="upload preset" style="width:100%" />
      </div>

      <!-- Cloudinary Usage Gauge -->
      <div style="margin-top:16px">
        <div style="font-weight:700; margin:8px 0">☁️ Cloudinary 사용량</div>
        <div id="cloudinaryUsageBar" class="usage-bar">
          <div id="cloudinaryUsageFill" class="usage-bar-fill"></div>
        </div>
        <div id="cloudinaryUsageText" class="muted" style="margin-top:4px; font-size:12px"></div>
      </div>

      <!-- Theme Selector -->
      <div style="margin-top:16px">
        <div style="font-weight:700; margin:8px 0">🎨 테마 선택</div>
        <div class="theme-selector">
          <button class="theme-btn active" data-theme="default">기본</button>
          <button class="theme-btn" data-theme="newborn">신생아 (노랑)</button>
          <button class="theme-btn" data-theme="infant">영아 (초록)</button>
          <button class="theme-btn" data-theme="toddler">유아 (분홍)</button>
        </div>
      </div>
      
      <!-- D-DAY 기준 설정 -->
      <div style="margin-top:16px">
        <div style="font-weight:700; margin:8px 0">🎯 D-DAY 기준일 설정</div>
        <input id="ddayInput" type="date" style="width:100%" />
      </div>
      
      <!-- Members -->
      <div style="margin-top:16px">
        <div style="font-weight:700; margin:8px 0">👨‍👩‍👧 가족 구성 관리</div>
        <div id="membersArea" class="chips"></div>
        <div style="display:flex; gap:8px; margin-top:8px">
          <input id="memberInput" type="text" placeholder="예: 👴 할아버지" style="flex:1" />
          <button id="memberAdd" class="btn secondary">추가</button>
          <button id="membersReset" class="btn secondary">기본으로</button>
        </div>
      </div>
      
      <!-- Albums -->
      <div style="margin-top:16px">
        <div style="font-weight:700; margin:8px 0">🗂️ 앨범 관리</div>
        <div id="albumsList" class="album-list"></div>
        <div style="display:flex; gap:8px; margin-top:8px">
          <input id="albumInput" type="text" placeholder="예: 100일, 첫걸음마" style="flex:1" />
          <button id="albumAdd" class="btn secondary">추가</button>
        </div>
      </div>
      
      <!-- Activity Logs -->
      <div style="margin-top:16px">
        <div style="font-weight:700; margin:8px 0">📊 접속 로그</div>
        <div id="activityLogsContainer" style="max-height:200px; overflow-y:auto; border:1px solid #e5e7eb; border-radius:8px; padding:8px;">
          <div id="activityLogsList" class="activity-logs"></div>
        </div>
        <button id="refreshLogs" class="btn secondary" style="margin-top:8px; width:100%">로그 새로고침</button>
      </div>
      
      <!-- Duplicate Photo Manager -->
      <div style="margin-top:16px">
        <div style="font-weight:700; margin:8px 0">🔍 중복 사진 관리</div>
        <button id="duplicateManagerBtn" class="btn secondary" style="width:100%">중복 사진 찾기</button>
      </div>
      
      <div style="margin-top:16px; display:none; gap:8px">
        <button id="save" class="btn">설정 저장(Firebase 사용)</button>
        <button id="skip" class="btn secondary">Firebase 없이 시작</button>
      </div>
      <div id="msg" class="muted" style="margin-top:8px; display:none"></div>
    </div>

    <!-- Login -->
    <div id="login" class="card hidden" style="text-align:center">
      <div style="margin-bottom:10px"><strong>👨‍👩‍👧‍👦 가족 구성원 선택</strong></div>
      <div id="loginChips" class="chips" style="justify-content:center"></div>
    </div>

    <!-- App -->
    <div id="app" class="hidden">
      <div style="padding:16px 0">
        <div><strong>안녕, <span id="me">-</span></strong></div>
      </div>

      <!-- Memory of the Day -->
      <div id="memoryDay" class="memory-day hidden">
        <h3>📅 작년 오늘의 추억</h3>
        <div id="memoryGrid" class="memory-grid"></div>
      </div>

      <!-- Tab Content Container -->
      <div class="tab-container" id="tabContainer">
        <!-- Timeline -->
        <div id="timeline" class="tab-content active"></div>

        <!-- Calendar -->
        <div id="calendar" class="tab-content">
          <div class="cal">
            <div class="calhead">
              <button id="prevM" class="btn secondary">◀</button>
              <div id="calTitle" class="cal-title-clickable"></div>
              <button id="nextM" class="btn secondary">▶</button>
            </div>
            <div class="grid" id="calGrid"></div>
          </div>
        </div>

        <!-- Albums -->
        <div id="albums" class="tab-content">
          <div class="album-manager">
            <div class="album-manager-header">
              <div style="font-weight:700">🗂️ 앨범별 보기</div>
              <div style="display:flex; gap:8px;">
                <button id="multiselectBtn" class="btn secondary">다중선택</button>
              </div>
            </div>
          </div>
          <div id="albumFilter" class="album-list"></div>
          <div id="albumPhotos" style="margin-top:16px"></div>
        </div>

        <!-- Schedule -->
        <div id="schedule" class="tab-content">
          <div class="schedule-manager">
            <div class="schedule-header">
              <div style="font-weight:700">📅 가족 일정표</div>
              <button id="addScheduleBtn" class="btn">+ 일정 추가</button>
            </div>
            
            <div class="schedule-calendar">
              <div class="schedule-cal-header">
                <button id="schedulePrevM" class="btn secondary">◀</button>
                <div id="scheduleCalTitle" class="cal-title-clickable"></div>
                <button id="scheduleNextM" class="btn secondary">▶</button>
              </div>
              <div class="schedule-cal-grid" id="scheduleCalGrid"></div>
            </div>
            
            <div class="schedule-list">
              <div style="font-weight:700; margin:16px 0 8px 0">📅 오늘의 일정</div>
              <div id="todaySchedules"></div>

              <div style="font-weight:700; margin:16px 0 8px 0">📋 예정된 일정</div>
              <div id="upcomingSchedules"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Date/Month/Year Picker Modal -->
  <div id="datePickerModal" class="date-picker-modal">
    <div class="date-picker-panel">
      <div class="date-picker-header" id="datePickerHeader">월 선택</div>
      <div id="datePickerContent"></div>
    </div>
  </div>

  <!-- Multi-select Bottom Bar -->
  <div id="multiselectBottomBar" class="multiselect-bottom-bar">
    <button id="moveToAlbumBtn" class="btn">📁 앨범 이동</button>
    <button id="deleteSelectedBtn" class="btn" style="background:#ef4444">🗑️ 삭제</button>
    <button id="cancelMultiselectBtn" class="btn secondary">❌ 취소</button>
  </div>

  <!-- FAB -->
  <button id="fab" class="fab" aria-label="업로드">＋</button>
  <input id="file" type="file" accept="image/*,video/*" multiple style="display:none" />
  <input id="calendarFile" type="file" accept="image/*,video/*" multiple style="display:none" />

  <!-- Upload Preview Overlay -->
  <div id="uploadPreviewOverlay" class="upload-preview-overlay" aria-hidden="true" tabindex="-1">
    <div class="upload-preview-header">
      <button id="uploadCancel" class="btn secondary">취소</button>
      <div class="upload-preview-title">사진 선택</div>
      <button id="uploadConfirm" class="btn">업로드</button>
    </div>
    <div id="uploadPreviewContainer" class="upload-preview-container">
      <div id="uploadPreviewGrid" class="upload-preview-grid"></div>
      <div id="uploadFastScrollTrack" class="fast-scroll-track">
        <div id="uploadFastScrollThumb" class="fast-scroll-thumb"></div>
      </div>
      <div id="uploadDateBubble" class="date-bubble"></div>
    </div>
  </div>

  <!-- Schedule Modal -->
  <div id="scheduleModal" class="modal" role="dialog" aria-modal="true">
    <div class="panel">
      <div class="schedule-modal-content">
        <div class="schedule-modal-header">
          <h3 id="scheduleModalTitle">일정 추가</h3>
          <button id="closeScheduleModal" class="action-btn">×</button>
        </div>
        
        <form id="scheduleForm" class="schedule-form">
          <div class="form-group">
            <label>제목</label>
            <input id="scheduleTitle" type="text" placeholder="일정 제목을 입력하세요" required />
          </div>
          
          <div class="form-group">
            <label>날짜</label>
            <input id="scheduleDate" type="date" required />
          </div>
          
          <div class="form-group">
            <label>시간</label>
            <input id="scheduleTime" type="time" />
          </div>
          
          <div class="form-group">
            <label>참여자</label>
            <div id="scheduleParticipants" class="participants-selector"></div>
          </div>
          
          <div class="form-group">
            <label>메모</label>
            <textarea id="scheduleMemo" placeholder="추가 메모가 있다면 입력하세요" rows="3"></textarea>
          </div>
          
          <div class="form-actions">
            <button type="button" id="deleteScheduleBtn" class="btn secondary" style="background:#ef4444; display:none;">삭제</button>
            <button type="submit" class="btn">저장</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div id="modal" class="modal" role="dialog" aria-modal="true">
    <div class="panel">
      <div class="viewer" id="modalViewer">
        <img id="big" src="" alt="미리보기" />
        <video id="bigVideo" controls playsinline></video>
        
        <!-- Top Header with D-Day and Date -->
        <div class="modal-top-header" id="modalTopHeader">
          <button id="modalBackBtn" class="modal-back-btn" title="뒤로">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="m12 19-7-7 7-7"/>
              <path d="M19 12H5"/>
            </svg>
          </button>
          <div class="modal-date-info">
            <div class="modal-dday" id="modalDday"></div>
            <div class="modal-date" id="modalDate"></div>
          </div>
          <div class="modal-actions" id="modalActions">
            <div class="modal-menu-container">
              <button id="modalMenuBtn" class="action-btn" title="메뉴">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <line x1="3" x2="21" y1="6" y2="6"/>
                  <line x1="3" x2="21" y1="12" y2="12"/>
                  <line x1="3" x2="21" y1="18" y2="18"/>
                </svg>
              </button>
              <div id="modalDropdown" class="modal-dropdown-menu hidden">
                <button class="modal-dropdown-item" id="modalAlbumBtn">📁 앨범에 추가</button>
                <a class="modal-dropdown-item" id="modalDlBtn" download target="_blank" rel="noopener">💾 다운로드</a>
                <button class="modal-dropdown-item modal-delete" id="modalDelBtn">🗑️ 삭제</button>
              </div>
            </div>
          </div>
        </div>
        
        <button id="prevBtn" class="navbtn prev" aria-label="이전">‹</button>
        <button id="nextBtn" class="navbtn next" aria-label="다음">›</button>
      </div>
      
      <!-- Bottom Footer with Reactions and Share -->
      <div class="modal-bottom-footer" id="modalBottomFooter">
        <div class="modal-reactions">
          <button class="reaction heart-reaction" data-emoji="❤️">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.29 1.51 4.04 3 5.5l7 7z"/>
            </svg>
            <span class="reaction-count">0</span>
          </button>
          <button class="reaction comment-toggle" id="commentToggleBtn">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
              <path d="M9 10h6"/>
              <path d="M9 14h6"/>
            </svg>
            <span class="comment-indicator"></span>
          </button>
        </div>
      </div>
      
      <div class="comments" id="modalComments">
        <div id="commentList" class="comment-list" aria-live="polite"></div>
        <div class="comment-input">
          <input id="commentInput" type="text" placeholder="댓글을 입력하세요" maxlength="300" />
          <button id="commentSend" class="btn">전송</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Day Grid Overlay -->
  <div id="dayGridOverlay" class="day-grid-overlay" aria-hidden="true" tabindex="-1">
    <!-- Multi-select Header -->
    <div id="dayGridMultiselectHeader" class="day-grid-multiselect-header">
      <div class="day-grid-multiselect-info" id="dayGridMultiselectInfo">0개 선택됨</div>
      <div class="day-grid-multiselect-actions">
        <button id="dayGridMoveToAlbum" class="day-grid-multiselect-btn">📁 앨범 이동</button>
        <button id="dayGridDeleteSelected" class="day-grid-multiselect-btn">🗑️ 삭제</button>
        <button id="dayGridCancelMultiselect" class="day-grid-multiselect-btn">✖ 취소</button>
      </div>
    </div>

    <div class="day-grid-content">
      <!-- Splash Image Section -->
      <div class="day-grid-splash" id="dayGridSplash">
        <img id="dayGridSplashImage" src="" alt="대표 이미지" />

        <!-- Controls on Splash -->
        <div class="day-grid-splash-controls">
          <button id="dayGridBack" class="splash-control-btn" aria-label="뒤로">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="m12 19-7-7 7-7"/>
              <path d="M19 12H5"/>
            </svg>
          </button>
          <div class="splash-menu-container">
            <button id="dayGridMenuBtn" class="splash-control-btn" aria-label="메뉴">⋯</button>
            <div id="dayGridDropdown" class="dropdown-menu hidden">
              <button class="dropdown-item" id="dropdownAddTag">🏷️ 태그 추가</button>
              <button class="dropdown-item" id="dropdownSelectAll">☑️ 일괄 선택</button>
              <button class="dropdown-item" id="dropdownDelete">🗑️ 삭제</button>
            </div>
          </div>
        </div>

        <div class="day-grid-splash-overlay">
          <div class="day-grid-splash-info">
            <div class="day-grid-splash-title" id="dayGridSplashTitle">
              <div class="splash-dday" id="dayGridDday"></div>
              <div class="splash-date" id="dayGridDate"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="day-grid" id="dayGrid"></div>
    </div>
  </div>

  <!-- Duplicate Photo Modal -->
  <div id="duplicateModal" class="modal" role="dialog" aria-modal="true">
    <div class="panel">
      <div id="duplicateContent"></div>
    </div>
  </div>

  <div id="stat" class="mutebar" title="클릭하여 온라인/오프라인 전환">offline</div>

  <script type="module" src="js/main.js"></script>
</body>
</html>
